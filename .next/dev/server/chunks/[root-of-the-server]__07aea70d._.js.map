{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/hemilpatel/Documents/dev/codex/aeogeoproj/lib/analysis/engine.ts"],"sourcesContent":["import crypto from \"crypto\";\nimport {\n  Analysis,\n  AnalysisContext,\n  AnalysisScoring,\n  AnalysisVersion,\n  DiagnosisReason,\n  PromptCluster,\n  RecommendedFix,\n} from \"./types\";\n\nconst ANALYSIS_VERSION: AnalysisVersion = \"v1\";\n\ntype TopicSignals = {\n  normalized: string;\n  lower: string;\n  words: string[];\n  hasQuestionWord: boolean;\n  hasQuestionMark: boolean;\n  hasComparison: boolean;\n  hasBestSuperlative: boolean;\n  hasTransactionalCue: boolean;\n  hasGeoCue: boolean;\n};\n\nconst questionWords = [\"who\", \"what\", \"when\", \"where\", \"why\", \"how\"];\nconst comparisonWords = [\"vs\", \"versus\", \"compare\", \"comparison\", \"against\"];\nconst superlatives = [\"best\", \"top\", \"leading\", \"most\"];\nconst transactionalWords = [\"buy\", \"price\", \"pricing\", \"cost\", \"deal\", \"order\", \"book\"];\nconst geoWords = [\"near me\", \"in \", \"at \", \"around\", \"closest\", \"local\"];\n\nfunction extractSignals(topic: string): TopicSignals {\n  const normalized = topic.trim();\n  const lower = normalized.toLowerCase();\n  const words = normalized.split(/\\s+/).filter(Boolean);\n  const hasQuestionWord = words.some((w) => questionWords.includes(w.toLowerCase()));\n  const hasQuestionMark = normalized.includes(\"?\");\n  const hasComparison = comparisonWords.some((w) => lower.includes(w));\n  const hasBestSuperlative = superlatives.some((w) => lower.includes(w));\n  const hasTransactionalCue = transactionalWords.some((w) => lower.includes(w));\n  const hasGeoCue = geoWords.some((w) => lower.includes(w));\n\n  return {\n    normalized,\n    lower,\n    words,\n    hasQuestionWord,\n    hasQuestionMark,\n    hasComparison,\n    hasBestSuperlative,\n    hasTransactionalCue,\n    hasGeoCue,\n  };\n}\n\nfunction deriveIntent(signals: TopicSignals): \"informational\" | \"navigational\" | \"transactional\" | \"ambiguous\" {\n  if (signals.hasTransactionalCue) {\n    return \"transactional\";\n  }\n  if (signals.hasQuestionWord || signals.hasComparison || signals.hasBestSuperlative) {\n    return \"informational\";\n  }\n  if (signals.hasGeoCue) {\n    return \"navigational\";\n  }\n  return \"ambiguous\";\n}\n\nfunction buildPromptClusters(signals: TopicSignals, context: AnalysisContext): PromptCluster[] {\n  const clusters: PromptCluster[] = [];\n\n  clusters.push({\n    label: \"specificity\",\n    signals: [\n      signals.words.length >= 4 ? \"has multi-word intent\" : \"ultra-short topic\",\n      signals.hasComparison ? \"comparison cue\" : \"no comparison cue\",\n      signals.hasBestSuperlative ? \"seeks ranked guidance\" : \"no ranking cue\",\n    ],\n  });\n\n  clusters.push({\n    label: \"context\",\n    signals: [\n      context.location ? `location: ${context.location}` : \"location missing\",\n      context.industry ? `industry: ${context.industry}` : \"industry missing\",\n      signals.hasGeoCue ? \"geo phrasing in topic\" : \"no geo phrasing in topic\",\n    ],\n  });\n\n  clusters.push({\n    label: \"actionability\",\n    signals: [\n      signals.hasTransactionalCue ? \"action/transaction cue\" : \"no action cue\",\n      signals.hasQuestionMark || signals.hasQuestionWord ? \"explicit ask\" : \"implicit ask\",\n    ],\n  });\n\n  return clusters;\n}\n\nfunction scoreClarity(signals: TopicSignals): number {\n  let score = 80;\n  if (signals.words.length < 3) score -= 20;\n  if (signals.words.length > 8) score += 5;\n  if (!signals.hasQuestionMark && !signals.hasQuestionWord) score -= 10;\n  if (signals.hasComparison || signals.hasBestSuperlative) score += 5;\n  if (signals.hasTransactionalCue) score += 5;\n\n  return Math.min(100, Math.max(0, score));\n}\n\nfunction deriveAnswerPresence(signals: TopicSignals): \"missing\" | \"partial\" | \"clear\" {\n  if (signals.hasQuestionWord || signals.hasQuestionMark) return \"clear\";\n  if (signals.hasTransactionalCue || signals.hasComparison || signals.hasBestSuperlative) return \"partial\";\n  return \"missing\";\n}\n\nfunction gatherStructureIssues(signals: TopicSignals, context: AnalysisContext): string[] {\n  const issues: string[] = [];\n  if (!signals.hasQuestionWord && !signals.hasQuestionMark) {\n    issues.push(\"Topic is not framed as a direct ask, so the AI must infer the question.\");\n  }\n  if (signals.words.length < 4) {\n    issues.push(\"Topic is very short, which weakens clarity of the expected answer.\");\n  }\n  if (signals.hasComparison && !signals.hasBestSuperlative) {\n    issues.push(\"Comparison prompt lacks criteria for how to decide a winner.\");\n  }\n  if (!context.location && signals.hasGeoCue) {\n    issues.push(\"Geo phrasing is present without an explicit location to anchor the answer.\");\n  }\n  if (!context.industry && !signals.hasTransactionalCue) {\n    issues.push(\"No industry or domain anchor is provided.\");\n  }\n  return issues;\n}\n\nfunction buildReasons(signals: TopicSignals, context: AnalysisContext): DiagnosisReason[] {\n  const reasons: DiagnosisReason[] = [];\n  const intent = deriveIntent(signals);\n\n  reasons.push({\n    id: \"reason_1\",\n    title: \"Ambiguous intent\",\n    detail:\n      intent === \"ambiguous\"\n        ? \"The topic does not declare whether the expected answer is informational, navigational, or transactional.\"\n        : \"The topic leaves room for multiple interpretations, so an AI answer may not match the user's real goal.\",\n    severity: \"high\",\n    rank: 1,\n  });\n\n  reasons.push({\n    id: \"reason_2\",\n    title: \"Missing context\",\n    detail: context.location || context.industry\n      ? \"Context is partial; AI still lacks clear guardrails to ground the answer.\"\n      : \"No location or industry anchor is provided, so the answer will stay generic and less trustworthy.\",\n    severity: context.location || context.industry ? \"medium\" : \"high\",\n    rank: 2,\n  });\n\n  reasons.push({\n    id: \"reason_3\",\n    title: \"Unstated answer format\",\n    detail:\n      signals.hasQuestionWord || signals.hasQuestionMark\n        ? \"The question is asked, but the expected format (checklist, steps, ranked list) is not specified.\"\n        : \"The topic is not phrased as a question, so the AI must guess the answer shape.\",\n    severity: \"medium\",\n    rank: 3,\n  });\n\n  if (!signals.hasTransactionalCue && !signals.hasBestSuperlative) {\n    reasons.push({\n      id: \"reason_4\",\n      title: \"Weak authority signals\",\n      detail: \"There are no qualifiers (e.g., timeframe, data points, audience) that would signal reliability.\",\n      severity: \"low\",\n      rank: 4,\n    });\n  }\n\n  return reasons.slice(0, 5);\n}\n\nfunction buildFixes(reasons: DiagnosisReason[]): RecommendedFix[] {\n  const fixes: RecommendedFix[] = [];\n\n  const reasonIds = new Set(reasons.map((r) => r.id));\n\n  if (reasonIds.has(\"reason_1\")) {\n    fixes.push({\n      id: \"fix_1\",\n      description: \"Rewrite the topic to name the exact action or decision you want (e.g., 'How to choose X for Y outcome').\",\n      why_it_matters: \"Explicit intent lets the AI choose a fitting reasoning path instead of guessing.\",\n      maps_to_reason_ids: [\"reason_1\"],\n    });\n  }\n\n  if (reasonIds.has(\"reason_2\")) {\n    fixes.push({\n      id: \"fix_2\",\n      description: \"Add location or industry qualifiers so the answer uses relevant constraints and examples.\",\n      why_it_matters: \"Grounding the request reduces generic output and improves trustworthiness.\",\n      maps_to_reason_ids: [\"reason_2\"],\n    });\n  }\n\n  if (reasonIds.has(\"reason_3\")) {\n    fixes.push({\n      id: \"fix_3\",\n      description: \"State the desired answer format (checklist, steps, ranked picks) and the decision criteria.\",\n      why_it_matters: \"Format cues help the AI organize the response and avoid irrelevant details.\",\n      maps_to_reason_ids: [\"reason_3\"],\n    });\n  }\n\n  if (reasonIds.has(\"reason_4\")) {\n    fixes.push({\n      id: \"fix_4\",\n      description: \"Include a grounding signal such as timeframe, audience, or data proof you expect the AI to cite.\",\n      why_it_matters: \"Authority cues signal that the answer should be supported, not speculative.\",\n      maps_to_reason_ids: [\"reason_4\"],\n    });\n  }\n\n  return fixes;\n}\n\nfunction scoreAnalysis(reasons: DiagnosisReason[], clarityScore: number): AnalysisScoring {\n  let score = 85;\n  const explanation: string[] = [];\n\n  reasons.forEach((reason) => {\n    const penalty = reason.severity === \"high\" ? 18 : reason.severity === \"medium\" ? 10 : 6;\n    score -= penalty;\n    explanation.push(`${reason.title} reduces confidence because ${reason.detail}`);\n  });\n\n  score += Math.round((clarityScore - 60) / 4);\n\n  return {\n    aeo_score: Math.max(0, Math.min(100, score)),\n    score_explanations: explanation.map((message, idx) => ({\n      id: `score_${idx + 1}`,\n      message,\n    })),\n  };\n}\n\nexport function generateAnalysis(id: string, topic: string, context: AnalysisContext = {}): Analysis {\n  const signals = extractSignals(topic);\n  const intent = deriveIntent(signals);\n  const promptClusters = buildPromptClusters(signals, context);\n  const clarity = scoreClarity(signals);\n  const answerPresence = deriveAnswerPresence(signals);\n  const structureIssues = gatherStructureIssues(signals, context);\n  const reasons = buildReasons(signals, context);\n  const fixes = buildFixes(reasons);\n  const scoring = scoreAnalysis(reasons, clarity);\n  const now = new Date().toISOString();\n\n  return {\n    id,\n    analysis_version: ANALYSIS_VERSION,\n    created_at: now,\n    updated_at: now,\n    source: {\n      type: \"topic\",\n      value: topic,\n    },\n    context,\n    prompt_intelligence: {\n      dominant_intent: intent,\n      intent_mismatch:\n        intent === \"ambiguous\"\n          ? \"AI cannot tell whether the ask is informational, navigational, or transactional.\"\n          : structureIssues.find((issue) => issue.toLowerCase().includes(\"not framed\"))\n          ? \"The ask is implied rather than explicit, so the AI may answer the wrong question.\"\n          : null,\n      prompt_clusters: promptClusters,\n    },\n    aeo: {\n      answer_clarity_score: clarity,\n      answer_presence: answerPresence,\n      structure_issues: structureIssues,\n    },\n    diagnosis: {\n      blocking_reasons: reasons,\n    },\n    fixes: {\n      recommended_fixes: fixes,\n    },\n    scoring,\n  };\n}\n\nexport function createAnalysisId(): string {\n  return crypto.randomUUID();\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 337, "column": 0}, "map": {"version":3,"sources":["file:///Users/hemilpatel/Documents/dev/codex/aeogeoproj/lib/persistence/memoryStore.ts"],"sourcesContent":["import { Analysis, AnalysisContext, AnalysisRecord, AnalysisStatus } from \"../analysis/types\";\n\ntype StoreState = {\n  records: Map<string, AnalysisRecord>;\n};\n\nconst globalStore: StoreState =\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  (globalThis as any).__analysisMemoryStore ??\n  {\n    records: new Map<string, AnalysisRecord>(),\n  };\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\n(globalThis as any).__analysisMemoryStore = globalStore;\n\nexport class InMemoryAnalysisStore {\n  createRecord(id: string, topic: string, context: AnalysisContext, status: AnalysisStatus): AnalysisRecord {\n    const now = new Date().toISOString();\n    const record: AnalysisRecord = {\n      id,\n      status,\n      created_at: now,\n      updated_at: now,\n      request: {\n        topic,\n        context,\n      },\n    };\n    globalStore.records.set(id, record);\n    return record;\n  }\n\n  saveAnalysis(id: string, analysis: Analysis, status: AnalysisStatus = \"complete\"): AnalysisRecord | undefined {\n    const record = globalStore.records.get(id);\n    if (!record) return undefined;\n    const updated: AnalysisRecord = {\n      ...record,\n      analysis,\n      status,\n      updated_at: new Date().toISOString(),\n    };\n    globalStore.records.set(id, updated);\n    return updated;\n  }\n\n  markFailed(id: string, error: string): AnalysisRecord | undefined {\n    const record = globalStore.records.get(id);\n    if (!record) return undefined;\n    const updated: AnalysisRecord = {\n      ...record,\n      status: \"failed\",\n      error,\n      updated_at: new Date().toISOString(),\n    };\n    globalStore.records.set(id, updated);\n    return updated;\n  }\n\n  getRecord(id: string): AnalysisRecord | undefined {\n    return globalStore.records.get(id);\n  }\n}\n\nexport const analysisStore = new InMemoryAnalysisStore();\n"],"names":[],"mappings":";;;;;;AAMA,MAAM,cACJ,8DAA8D;AAC7D,WAAmB,qBAAqB,IACzC;IACE,SAAS,IAAI;AACf;AAEF,8DAA8D;AAC7D,WAAmB,qBAAqB,GAAG;AAErC,MAAM;IACX,aAAa,EAAU,EAAE,KAAa,EAAE,OAAwB,EAAE,MAAsB,EAAkB;QACxG,MAAM,MAAM,IAAI,OAAO,WAAW;QAClC,MAAM,SAAyB;YAC7B;YACA;YACA,YAAY;YACZ,YAAY;YACZ,SAAS;gBACP;gBACA;YACF;QACF;QACA,YAAY,OAAO,CAAC,GAAG,CAAC,IAAI;QAC5B,OAAO;IACT;IAEA,aAAa,EAAU,EAAE,QAAkB,EAAE,SAAyB,UAAU,EAA8B;QAC5G,MAAM,SAAS,YAAY,OAAO,CAAC,GAAG,CAAC;QACvC,IAAI,CAAC,QAAQ,OAAO;QACpB,MAAM,UAA0B;YAC9B,GAAG,MAAM;YACT;YACA;YACA,YAAY,IAAI,OAAO,WAAW;QACpC;QACA,YAAY,OAAO,CAAC,GAAG,CAAC,IAAI;QAC5B,OAAO;IACT;IAEA,WAAW,EAAU,EAAE,KAAa,EAA8B;QAChE,MAAM,SAAS,YAAY,OAAO,CAAC,GAAG,CAAC;QACvC,IAAI,CAAC,QAAQ,OAAO;QACpB,MAAM,UAA0B;YAC9B,GAAG,MAAM;YACT,QAAQ;YACR;YACA,YAAY,IAAI,OAAO,WAAW;QACpC;QACA,YAAY,OAAO,CAAC,GAAG,CAAC,IAAI;QAC5B,OAAO;IACT;IAEA,UAAU,EAAU,EAA8B;QAChD,OAAO,YAAY,OAAO,CAAC,GAAG,CAAC;IACjC;AACF;AAEO,MAAM,gBAAgB,IAAI"}},
    {"offset": {"line": 398, "column": 0}, "map": {"version":3,"sources":["file:///Users/hemilpatel/Documents/dev/codex/aeogeoproj/app/api/analyses/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { createAnalysisId, generateAnalysis } from \"@/lib/analysis/engine\";\nimport { analysisStore } from \"@/lib/persistence/memoryStore\";\nimport { AnalysisContext } from \"@/lib/analysis/types\";\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const topic = typeof body?.topic === \"string\" ? body.topic.trim() : \"\";\n    if (!topic) {\n      return NextResponse.json({ error: \"topic is required\" }, { status: 400 });\n    }\n\n    const context: AnalysisContext = body?.context ?? {};\n    const id = createAnalysisId();\n\n    analysisStore.createRecord(id, topic, context, \"processing\");\n    const analysis = generateAnalysis(id, topic, context);\n    analysisStore.saveAnalysis(id, analysis, \"complete\");\n\n    return NextResponse.json({ analysis_id: id, status: \"complete\" });\n  } catch (_error) {\n    return NextResponse.json({ error: \"Unable to create analysis\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAGO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,QAAQ,OAAO,MAAM,UAAU,WAAW,KAAK,KAAK,CAAC,IAAI,KAAK;QACpE,IAAI,CAAC,OAAO;YACV,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QAEA,MAAM,UAA2B,MAAM,WAAW,CAAC;QACnD,MAAM,KAAK,IAAA,+IAAgB;QAE3B,oJAAa,CAAC,YAAY,CAAC,IAAI,OAAO,SAAS;QAC/C,MAAM,WAAW,IAAA,+IAAgB,EAAC,IAAI,OAAO;QAC7C,oJAAa,CAAC,YAAY,CAAC,IAAI,UAAU;QAEzC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,aAAa;YAAI,QAAQ;QAAW;IACjE,EAAE,OAAO,QAAQ;QACf,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA4B,GAAG;YAAE,QAAQ;QAAI;IACjF;AACF"}}]
}